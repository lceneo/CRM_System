<nav class="btn_container">

  <i *ngIf = "chatType === 'Mine'"
     [matTooltip]="'Покинуть'"
     class="bi bi-box-arrow-in-left leaveBtn"
     (click) = "leaveChat()"
  ></i>

  <button mat-icon-button
   *ngIf="chatType !== 'Archive' && chatType !== 'Inbox'"
   [matTooltip]="chat?.status === ChatStatus.Blocked ? 'Разблокировать' : 'Заблокировать'"
   [ngClass]="{
    unblockBtn: chat?.status === ChatStatus.Blocked
   }"
   class="blockBtn"
   (click) = "toggleBlockStatus()"
  >
    <mat-icon>{{chat?.status === ChatStatus.Blocked ? 'remove_circle' : 'block'}}</mat-icon>
  </button>

  <button mat-icon-button
          *ngIf="chatType !== 'Inbox' && chatType !== 'Block'"
          [matTooltip]="chat?.status === ChatStatus.Archive ? 'Разархивировать' : 'В архив'"
          [ngClass]="{
          unblockBtn: chat?.status === ChatStatus.Blocked
   }"
          class="archiveBtn"
          (click) = "toggleArchiveStatus()"
  >
    <mat-icon>{{chat?.status === ChatStatus.Archive ? 'unarchive' : 'archive'}}</mat-icon>
  </button>

  <button
    class="btn-close close pull-right"
    aria-label="Close"
    [matTooltip]="'Закрыть'"
    (click) = "closeDialog()"
  >
    <span aria-hidden="true" class="visually-hidden">&times;</span>
  </button>
</nav>


<section class="chat">

  <mat-spinner
    *ngIf="loadingChat$ | async; else chatTemplate"
    class="spinner"
  ></mat-spinner>
  <ng-template #chatTemplate>
    <ul class="chat__messages" #msgList>
      <li *ngFor="let message of messages()"
          class="chat__message card"
          [ngClass]="{
            'chat__myMsg': message.sender && message.mine,
            'chat__companionMsg':  message.sender && !message.mine,
            'chat__systemMsg': !message.sender && message.type === MessageType.System
          }"
      >
        <app-message [message]="message"></app-message>
      </li>
    </ul>

  <ng-container
    [ngSwitch]="chatType">

    <div class="form-group textMsgArea"
         *ngSwitchCase="'Mine'"
    >
      <button mat-icon-button
              [matMenuTriggerFor]="attachmentMenu"
              [matBadge]="currentFile ? 1 : 0"
              [matBadgeHidden] = "!currentFile"
              [matTooltip]="'Файлы'"
      >
        <mat-icon> attach_file</mat-icon>
      </button>
      <textarea #message appTextareaResize
                class="chat__sendMsg form-control"
                (drop)="dropFile($event)"
                [(ngModel)] = "msgValue"
                [placeholder]="'Введите сообщение...'"
                (keydown)="pressKey($event)"
      ></textarea>

      <i
        class="bi bi-send sendMsgBtn"
        [ngClass]="{
          'msgNotEmpty': !!msgValue.trim().length || currentFile
        }"
        [matTooltip]="'Отправить сообщение'"
        [matTooltipDisabled] = "!msgValue.trim().length && !currentFile"
        (click) = "sendMsg()"></i>
    </div>

    <div class="chat__btnContainer"
         *ngSwitchCase="'Inbox'"
    >
      <button
        class="btn btn-success"
        (click)="joinChat()"
      >Принять</button>
      <button
        class="btn btn-danger"
      >Отклонить</button>
    </div>
  </ng-container>
</ng-template>

</section>

<mat-menu #attachmentMenu>
    <input #fileInput
           style="display: none"
           type="file"
           (change)="onFileChange($event)"
    >
    <button mat-menu-item
            [disabled] = "!!currentFile"
            [matTooltip]="'Не больше одного файла'"
            [matTooltipDisabled] = "!currentFile"
            (click) = "fileInput.click()">Вложить</button>

    <button mat-menu-item
            (click) = "currentFile = undefined;"
            [disabled] = "!currentFile"
    >Удалить</button>
</mat-menu>
